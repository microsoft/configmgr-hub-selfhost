<sequence version="3.10">
  <referenceList>
    <reference package="OPC00465" />
    <reference package="OPC00003" />
  </referenceList>
  <globalVarList>
    <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering">false</variable>
    <variable name="OSDAdapterCount" property="NumAdapters">0</variable>
  </globalVarList>
  <group name="Install Operating System" description="Actions to run in Windows PE to install and configure the image">
    <step type="SMS_TaskSequence_RebootAction" name="Restart in Windows PE" description="" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">equals</variable>
          <variable name="Value">false</variable>
          <variable name="Variable">_SMSTSInWinPE</variable>
        </expression>
      </condition>
      <action>smsboot.exe /target:WinPE</action>
      <defaultVarList>
        <variable name="SMSRebootMessage" property="Message">A new Microsoft Windows operating system is being installed.  The computer must reboot to continue.</variable>
        <variable name="SMSRebootTimeout" property="MessageTimeout">10</variable>
        <variable name="SMSRebootTarget" property="Target" hidden="true">WinPE</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_PartitionDiskAction" name="Partition Disk 0 - BIOS" description="This action partitions and formats the disk for new deployments of BIOS-based computers. This step will not run for Unified Extensible Firmware Interface (UEFI)-based computers." runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notExists</variable>
          <variable name="Variable">_SMSTSClientCache</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">OEMMedia</variable>
          <variable name="Variable">_SMSTSMediaType</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_OSDMigrateUseHardlinks</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_SMSTSBootUEFI</variable>
        </expression>
      </condition>
      <action>osddiskpart.exe</action>
      <defaultVarList>
        <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
        <variable name="OSDDiskType" property="DiskType">Basic</variable>
        <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
        <variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable>
        <variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable>
        <variable name="OSDPartitions" property="Partitions" hidden="true">3</variable>
        <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable>
        <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
        <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
        <variable name="OSDPartitions0Size" property="Partitions0Size">350</variable>
        <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
        <variable name="OSDPartitions0Type" property="Partitions0Type">Primary</variable>
        <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">System Reserved</variable>
        <variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">true</variable>
        <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
        <variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">NTFS</variable>
        <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable>
        <variable name="OSDPartitions1Size" property="Partitions1Size">99</variable>
        <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">Percent</variable>
        <variable name="OSDPartitions1Type" property="Partitions1Type">Primary</variable>
        <variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">Windows</variable>
        <variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable>
        <variable name="OSDPartitions2FileSystem" property="Partitions2FileSystem">NTFS</variable>
        <variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable>
        <variable name="OSDPartitions2Size" property="Partitions2Size">100</variable>
        <variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">Percent</variable>
        <variable name="OSDPartitions2Type" property="Partitions2Type">Recovery</variable>
        <variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">Recovery</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_PartitionDiskAction" name="Partition Disk 0 - UEFI" description="This action partitions and formats the disk for new deployments of Unified Extensible Firmware Interface (UEFI)-based computers. This step will not run for BIOS-based computers." runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notExists</variable>
          <variable name="Variable">_SMSTSClientCache</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">OEMMedia</variable>
          <variable name="Variable">_SMSTSMediaType</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_OSDMigrateUseHardlinks</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">equals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_SMSTSBootUEFI</variable>
        </expression>
      </condition>
      <action>osddiskpart.exe</action>
      <defaultVarList>
        <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
        <variable name="OSDDiskType" property="DiskType">Basic</variable>
        <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
        <variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable>
        <variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable>
        <variable name="OSDPartitions" property="Partitions" hidden="true">4</variable>
        <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable>
        <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">FAT32</variable>
        <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
        <variable name="OSDPartitions0Size" property="Partitions0Size">500</variable>
        <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
        <variable name="OSDPartitions0Type" property="Partitions0Type">EFI</variable>
        <variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
        <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">false</variable>
        <variable name="OSDPartitions1Size" property="Partitions1Size">128</variable>
        <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable>
        <variable name="OSDPartitions1Type" property="Partitions1Type">MSR</variable>
        <variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">true</variable>
        <variable name="OSDPartitions2Bootable" property="Partitions2Bootable">true</variable>
        <variable name="OSDPartitions2FileSystem" property="Partitions2FileSystem">NTFS</variable>
        <variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable>
        <variable name="OSDPartitions2Size" property="Partitions2Size">99</variable>
        <variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">Percent</variable>
        <variable name="OSDPartitions2Type" property="Partitions2Type">Primary</variable>
        <variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">Windows</variable>
        <variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable>
        <variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable>
        <variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable>
        <variable name="OSDPartitions3Size" property="Partitions3Size">100</variable>
        <variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">Percent</variable>
        <variable name="OSDPartitions3Type" property="Partitions3Type">Recovery</variable>
        <variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">Recovery</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyOperatingSystemAction" name="Apply Operating System" description="Actions to apply operating system" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>OSDApplyOS.exe /image:OPC00465,%OSDImageIndex% /runfromnet:False</action>
      <defaultVarList>
        <variable name="OSDImageIndex" property="ImageIndex">3</variable>
        <variable name="ImagePackageID" property="ImagePackageID" hidden="true">OPC00465</variable>
        <variable name="RunFromNet" property="RunFromNet" hidden="true">false</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyWindowsSettingsAction" name="Apply Windows Settings" description="Actions to apply Windows settings" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdwinsettings.exe /config</action>
      <defaultVarList>
        <variable name="OSDLocalAdminPassword" property="AdminPassword"></variable>
        <variable name="OSDComputerName" property="ComputerName">%_SMSTSMachineName%</variable>
        <variable name="OSDWindowsSettingsInputLocale" property="InputLocale">en-US</variable>
        <variable name="OSDProductKey" property="ProductKey"></variable>
        <variable name="OSDRandomAdminPassword" property="RandomAdminPassword">false</variable>
        <variable name="OSDRegisteredOrgName" property="RegisteredOrgName">KERWINM-003</variable>
        <variable name="OSDRegisteredUserName" property="RegisteredUserName">kerwinm</variable>
        <variable name="OSDServerLicenseConnectionLimit" property="ServerLicenseConnectionLimit">5</variable>
        <variable name="OSDWindowsSettingsSystemLocale" property="SystemLocale"></variable>
        <variable name="OSDTimeZone" property="TimeZone">Pacific Standard Time</variable>
        <variable name="OSDWindowsSettingsUILanguage" property="UILanguage"></variable>
        <variable name="OSDWindowsSettingsUILanguageFallback" property="UILanguageFallback"></variable>
        <variable name="OSDWindowsSettingsUserLocale" property="UserLocale"></variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyNetworkSettingsAction" name="Apply Network Settings" description="Actions to configure network settings" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdnetsettings.exe configure</action>
      <defaultVarList>
        <variable name="OSDJoinAccount" property="DomainUsername"></variable>
        <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering" hidden="true">false</variable>
        <variable name="OSDNetworkJoinType" property="NetworkJoinType">1</variable>
        <variable name="OSDAdapterCount" property="NumAdapters" hidden="true">0</variable>
        <variable name="OSDWorkgroupName" property="WorkgroupName">WG</variable>
      </defaultVarList>
    </step>
  </group>
  <group name="Setup Operating System" description="Setup Operating System">
    <step type="SMS_TaskSequence_SetupWindowsAndSMSAction" name="Setup Windows and Configuration Manager" description="Actions to setup Windows and Configuration Manager client" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <action>OSDSetupWindows.exe</action>
      <defaultVarList>
        <variable name="SMSClientInstallProperties" property="ClientInstallProperties"></variable>
        <variable name="_SMSClientPackageID" property="ClientPackageID">OPC00003</variable>
      </defaultVarList>
    </step>
  </group>
</sequence>